name: Validate Base Branch

on:
  workflow_call:
    inputs:
      pr_number:
        required: true
        type: number
      pr_source_branch:
        required: true
        type: string
      pr_base_branch:
        required: true
        type: string
      pr_is_draft:
        required: true
        type: boolean

jobs:
  validate-base-branch:
    runs-on: ubuntu-latest
    if: ${{ inputs.pr_is_draft == false }}
    steps:
      - name: Check PR base branch
        run: |
          SOURCE="${{ inputs.pr_source_branch }}"
          BASE="${{ inputs.pr_base_branch }}"

          echo "Source branch: $SOURCE"
          echo "Base branch: $BASE"

          # Feature, chore, docs → dev
          if [[ "$SOURCE" =~ ^(feature|chore|docs)/ ]] && [[ "$BASE" != "develop" ]]; then
            echo "❌ $SOURCE must target 'develop' branch"
            exit 1
          fi

          # Release → main or develop
          if [[ "$SOURCE" =~ ^release/ ]] && [[ "$BASE" != "main" && "$BASE" != "develop" ]]; then
            echo "❌ $SOURCE must target 'main' or 'develop'"
            exit 1
          fi

          # Bugfix → release/*
          if [[ "$SOURCE" =~ ^bugfix/ ]] && [[ ! "$BASE" =~ ^release/ ]]; then
            echo "❌ $SOURCE must target a release branch"
            exit 1
          fi

          # Hotfix → main
          if [[ "$SOURCE" =~ ^hotfix/ ]] && [[ "$BASE" != "main" ]]; then
            echo "❌ $SOURCE must target 'main' branch"
            exit 1
          fi

          echo "✅ PR base branch is valid"