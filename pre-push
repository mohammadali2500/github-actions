#!/bin/sh
# Pre-push hook: validate branch name with different rules

branch_name=$(git rev-parse --abbrev-ref HEAD)

validate_branch() {
  local name="$1"
  local pattern="$2"
  if echo "$name" | grep -Eq "$pattern"; then
    return 0
  else
    return 1
  fi
}

case "$branch_name" in
  feature/*)
    if validate_branch "$branch_name" '^feature\/[A-Z]{2}[0-9]{7}-[a-z0-9\-]{3,}$'; then
      echo "‚úÖ Branch name '$branch_name' is valid (feature)"
      exit 0
    fi
    ;;
  bugfix/*)
    if validate_branch "$branch_name" '^(bugfix)\/[0-9]+\.[0-9]+\.[0-9]+\/[A-Z]{2}[0-9]{7}$'; then
      echo "‚úÖ Branch name '$branch_name' is valid (bugfix)"
      exit 0
    fi
    ;;
  hotfix/*)
    if validate_branch "$branch_name" '^(hotfix)\/[0-9]+\.[0-9]+\.[0-9]+\/[A-Z]{2}[0-9]{7}$'; then
      echo "‚úÖ Branch name '$branch_name' is valid (hotfix)"
      exit 0
    fi
    ;;
  release/*)
    if validate_branch "$branch_name" '^release\/[0-9]+\.[0-9]+\.[0-9]+$'; then
      echo "‚úÖ Branch name '$branch_name' is valid (release)"
      exit 0
    fi
    ;;
esac

# If we reached here, validation failed
echo "‚ùå Invalid branch name: $branch_name"
echo ""
echo "üëâ Allowed formats are:"
echo "   feature/<PROJ#######-task>    e.g., feature/AB1234567-add-login-api"
echo "   bugfix/<version>/<PROJ#######> e.g., bugfix/1.0.0/US1234567"
echo "   hotfix/<version>/<PROJ#######> e.g., hotfix/2.1.3/US7654321"
echo "   release/<version>              e.g., release/1.2.3"
exit 1